<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Petshop</title>
    <link rel="stylesheet" href="../css/index.css" />
    <link rel="shortcut icon" href="../assets/title.svg" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Alegreya:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,800;1,900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header>
      <nav class="header__nav">
        <div>
          <a href="index.html" class="header__logo">
            <img src="../assets/title.svg" alt="" />
            <h4>PetShop</h4>
          </a>
        </div>
        <ul class="header__menu">
          <li><a href="index.html#proizvodi">Proizvodi</a></li>
          <li><a href="#admin__links">Admin</a></li>
          <li><a href="about-us.html">O nama</a></li>
          <li><a href="#" onclick="openForm()">Prijavite se</a></li>
        </ul>
        <div class="menu-cart">
          <ul class="header__menu-mobile">
            <li>
              <img src="../assets/menu.svg" alt="menu" class="hamburger" />
            </li>
          </ul>
          <div class="cart">
            <a href="cart.html"
              ><img src="../assets/shopping-cart-icon.png" alt="cart"
            /></a>
          </div>
        </div>
      </nav>
    </header>
    <div>
      <div class="login__popup" id="popup">
        <form action="#" class="form__container" id="prijava">
          <h1>Prijava</h1>

          <label for="email"><b>Email</b></label>
          <input type="text" placeholder="Enter Email" name="email" required />

          <label for="password"><b>Lozinka</b></label>
          <input
            type="password"
            placeholder="Enter Password"
            name="password"
            required
          />
          <div>
            <button type="button" onclick="closeForm()" class="btn">
              Prijavite se
            </button>
            <button type="button" class="btn" onclick="closeForm()">
              Nazad
            </button>
          </div>
          <p onclick="openReg()">Registrujte se</p>
        </form>
        <div>
          <form id="registracija" style="display: none" class="form__container">
            <label for="ime">Ime:</label>
            <input type="text" id="ime" required /><br />

            <label for="prezime">Prezime:</label>
            <input type="text" id="prezime" required /><br />

            <label for="datumRodjenja">Datum rođenja:</label>
            <input type="date" id="datumRodjenja" required /><br />

            <label for="adresa">Adresa:</label>
            <input type="text" id="adresa" required /><br />

            <label for="email">Email:</label>
            <input type="email" id="email" required /><br />

            <label for="telefon">Telefon:</label>
            <input type="tel" id="telefon" required /><br />

            <label for="korisnickoIme">Korisničko ime:</label>
            <input type="text" id="korisnickoIme" required /><br />

            <label for="lozinka">Lozinka:</label>
            <input type="password" id="lozinka" required /><br />

            <button type="button" class="btn" id="submit">Potvrdi</button>
            <button class="btn" onclick="closeForm()">Nazad</button>
          </form>
        </div>
      </div>
    </div>

    <div class="edit-users__form">
      <form id="edit-users" style="display: none" class="form__container">
        <label for="edit-ime">Ime:</label>
        <input type="text" id="edit-ime" required /><br />

        <label for="edit-prezime">Prezime:</label>
        <input type="text" id="edit-prezime" required /><br />

        <label for="edit-datumRodjenja">Datum rođenja:</label>
        <input type="date" id="edit-datumRodjenja" required /><br />

        <label for="edit-adresa">Adresa:</label>
        <input type="text" id="edit-adresa" required /><br />

        <label for="edit-email">Email:</label>
        <input type="email" id="edit-email" required /><br />

        <label for="edit-telefon">Telefon:</label>
        <input type="tel" id="edit-telefon" required /><br />

        <label for="edit-korisnickoIme">Korisničko ime:</label>
        <input type="text" id="edit-korisnickoIme" required /><br />

        <label for="edit-lozinka">Lozinka:</label>
        <input type="password" id="edit-lozinka" required /><br />

        <button type="button" class="btn" id="edit-submit">Potvrdi</button>
        <button class="btn" onclick="closeForm2()">Nazad</button>
      </form>
    </div>
    <section class="products__list">
      <h1>Lista korisnika</h1>

      <div class="table__container">
        <table id="korisniciTable">
          <thead>
            <tr>
              <th>Korisnicko ime</th>
              <th>Ime</th>
              <th>Prezime</th>
              <th>Email</th>
              <th>Telfon</th>
            </tr>
          </thead>
          <tbody>
            <!-- <tr>
              <td><a href="user.html">petar</a></td>
              <td>Petar</td>
              <td>Petrovic</td>
              <td>ppetrovic@webd.com</td>
              <td>061-456-456</td>
              <td class="table__buttons">
                <img src="../assets/edit.png" alt="" />
                <img src="../assets/delete.png" alt="" />
              </td>
            </tr> -->
          </tbody>
        </table>
      </div>
      <button class="btn__add-products" onclick="openReg2()">
        Dodaj Korisnika
      </button>
      <!-- <div class="hidden" id="add-products">
        <div class="add__products">
          <p class="close-add-popup" onclick="closeFormAddProducts()">
            &#10006;
          </p>
          <form action="#" method="post" enctype="multipart/form-data">
            <div>
              <label for="userName">Korisnicko ime:</label>
              <input type="text" id="userName" name="userName" required />
            </div>

            <div>
              <label for="Ime">Ime:</label>
              <input id="Ime" name="Ime" required />
            </div>

            <div>
              <label for="Prezime">Prezime:</label>
              <input id="Prezime" name="Prezime" required />
            </div>

            <div>
              <label for="email">Email:</label>
              <input type="email" id="email" name="email" required />
            </div>

            <div>
              <label for="broj">Broj Telefona:</label>
              <input type="tel" id="broj" name="broj" required />
            </div>

            <button class="btn__add-products" onclick="closeFormAddProducts()">
              Dodaj korisnika
            </button>
          </form>
        </div> -->
      <!-- </div> -->
    </section>
    <div id="overlay"></div>
    <footer class="footer">
      <div>
        <img src="../assets/title.svg" alt="" class="footer__img" />
      </div>
      <div>
        <h2>Linkovi</h2>
        <ul class="links">
          <li><a href="index.html#proizvodi">Proizvodi</a></li>
          <li><a href="#admin__links">Admin</a></li>
          <li><a href="about-us.html">O nama</a></li>
          <li><a href="#" onclick="openForm()">Prijavite se</a></li>
        </ul>
      </div>
      <div>
        <h2>Admin</h2>
        <ul class="links" id="admin__links">
          <li><a href="ListOfProducts.html">Proizvodi</a></li>

          <li><a href="listOfUsers.html">Korisnici</a></li>
        </ul>
      </div>
      <div>
        <h2>Zapratite nas</h2>
        <ul class="links social">
          <li>
            <a href="#">
              <img src="../assets/square-facebook.svg" alt="" /> Facebook</a
            >
          </li>
          <li>
            <a href="#"
              ><img src="../assets/square-instagram.svg" alt="" /> Instagram</a
            >
          </li>
          <li>
            <a href="#"
              ><img src="../assets/square-twitter.svg" alt="" /> Twitter</a
            >
          </li>
        </ul>
      </div>
    </footer>
    <div class="after__footer">
      <p>Made by FTN &copy;</p>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getDatabase,
        ref,
        onValue,
        remove,
        update,
        set,
        get,
        child,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDSN0vbu-NWOLwJJHpAbhanlns666rGgRk",
        authDomain: "petshop-200ae.firebaseapp.com",
        databaseURL: "https://petshop-200ae-default-rtdb.firebaseio.com",
        projectId: "petshop-200ae",
        storageBucket: "petshop-200ae.appspot.com",
        messagingSenderId: "332500787103",
        appId: "1:332500787103:web:4b5ba921b52d4bce9f27aa",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      function openUserDetails(userID) {
        const userDetailsUrl = `user.html?key=${userID}`;
        window.location.href = userDetailsUrl;
      }
      const korisniciRef = ref(db, "korisnici");
      onValue(korisniciRef, (snapshot) => {
        const korisnici = snapshot.val();
        console.log(korisnici);
      });
      document.getElementById("submit").addEventListener("click", function (e) {
        e.preventDefault();
        var ime = document.getElementById("ime").value;
        var prezime = document.getElementById("prezime").value;
        var datumRodjenja = document.getElementById("datumRodjenja").value;
        var adresa = document.getElementById("adresa").value;
        var email = document.getElementById("email").value;
        var telefon = document.getElementById("telefon").value;
        var korisnickoIme = document.getElementById("korisnickoIme").value;
        var lozinka = document.getElementById("lozinka").value;
        if (korisnickoIme.length < 5) {
          alert("Korisničko ime mora imati barem 5 karaktera.");
          return;
        }
        if (lozinka.length < 8) {
          alert("Lozinka mora imati barem 8 karaktera.");
          return;
        }
        var korisnik = {
          ime: ime,
          prezime: prezime,
          datumRodjenja: datumRodjenja,
          adresa: adresa,
          email: email,
          telefon: telefon,
          korisnickoIme: korisnickoIme,
          lozinka: lozinka,
        };

        set(ref(db, "korisnici/" + korisnickoIme), korisnik);

        alert("Korisnik uspešno dodat u bazu!");
      });
      let currentUserId = null;

      function editUser(userId) {
        document.getElementById("edit-users").style.display = "block";
        document.querySelector(".edit-users__form").style.display = "block";
        console.log(userId);

        const korisnikRef = ref(db, "korisnici/" + userId);
        get(korisnikRef).then((snapshot) => {
          const korisnik = snapshot.val();
          console.log(korisnik);
          if (korisnik) {
            document.getElementById("edit-ime").value = korisnik.ime;
            document.getElementById("edit-prezime").value = korisnik.prezime;
            document.getElementById("edit-datumRodjenja").value =
              korisnik.datumRodjenja;
            document.getElementById("edit-adresa").value = korisnik.adresa;
            document.getElementById("edit-email").value = korisnik.email;
            document.getElementById("edit-telefon").value = korisnik.telefon;
            document.getElementById("edit-korisnickoIme").value =
              korisnik.korisnickoIme;
            document.getElementById("edit-lozinka").value = korisnik.lozinka;

            currentUserId = userId;
          }
        });
      }

      function updateUser() {
        var updateIme = document.getElementById("edit-ime").value;
        var updatePrezime = document.getElementById("edit-prezime").value;
        var updateDatumRodjenja =
          document.getElementById("edit-datumRodjenja").value;
        var updateAdresa = document.getElementById("edit-adresa").value;
        var updateEmail = document.getElementById("edit-email").value;
        var updateTelefon = document.getElementById("edit-telefon").value;
        var updateKorisnickoIme =
          document.getElementById("edit-korisnickoIme").value;
        var updateLozinka = document.getElementById("edit-lozinka").value;

        var updatedUser = {
          ime: updateIme,
          prezime: updatePrezime,
          datumRodjenja: updateDatumRodjenja,
          adresa: updateAdresa,
          email: updateEmail,
          telefon: updateTelefon,
          korisnickoIme: updateKorisnickoIme,
          lozinka: updateLozinka,
        };

        const korisnikRef = ref(db, "korisnici/" + currentUserId);
        update(korisnikRef, updatedUser);

        document.getElementById("edit-users").classList.add("hidden");
        document.querySelector(".edit-users__form").style.display = "none";

        currentUserId = null;
      }
      document
        .getElementById("edit-submit")
        .addEventListener("click", function () {
          updateUser();
        });
      const korisniciTable = document.getElementById("korisniciTable");
      const MAX_NAZIV_LENGTH = 10;
      onValue(korisniciRef, (snapshot) => {
        const korisnici = snapshot.val();
        korisniciTable.innerHTML = "";
        for (const korisnikKey in korisnici) {
          const korisnik = korisnici[korisnikKey];

          const trTag = document.createElement("tr");

          const tdUSERNAME = document.createElement("td");
          tdUSERNAME.textContent = korisnik.korisnickoIme;
          trTag.appendChild(tdUSERNAME);

          const tdIme = document.createElement("td");
          tdIme.textContent = korisnik.ime;
          trTag.appendChild(tdIme);

          const tdPrezime = document.createElement("td");
          tdPrezime.textContent = korisnik.prezime;
          trTag.appendChild(tdPrezime);

          const tdEmail = document.createElement("td");
          tdEmail.textContent = korisnik.email;
          trTag.appendChild(tdEmail);
          const tdBroj = document.createElement("td");
          tdBroj.textContent = korisnik.telefon;
          trTag.appendChild(tdBroj);

          korisniciTable.appendChild(trTag);

          const tdButtons = document.createElement("td");
          tdButtons.classList.add("table__buttons");

          const editImg = document.createElement("img");
          editImg.src = "../assets/edit.png";
          editImg.alt = "Edit";
          editImg.addEventListener("click", function (e) {
            e.preventDefault();
            editUser(korisnikKey);
          });
          tdButtons.appendChild(editImg);

          const deleteImg = document.createElement("img");
          deleteImg.src = "../assets/delete.png";
          deleteImg.alt = "Delete";
          deleteImg.addEventListener("click", function () {
            remove(ref(db, "korisnici/" + korisnikKey));
          });
          tdButtons.appendChild(deleteImg);
          const eyeImg = document.createElement("img");
          eyeImg.src = "../assets/eye.png";
          eyeImg.alt = "Preview";
          eyeImg.addEventListener("click", function () {
            openUserDetails(korisnikKey);
          });
          tdButtons.appendChild(eyeImg);

          trTag.appendChild(tdButtons);
        }
      });
    </script>
    <script src="../js/index.js"></script>
  </body>
</html>
